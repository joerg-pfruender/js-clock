<!DOCTYPE html>
<html>
<head>
  <title>timetest</title>
  <script type="text/javascript" src="../main/js/timepicker.js"></script>
  <link rel="stylesheet" type="text/css" href="../main/css/timePickerTest.css">
</head>
<body>
<div id="testroot"></div>
<h3>Test harness for clock</h3>
<!--<input type="time" name="usr_time1">-->
<input type="time" name="usr_time2">
<section>


  <br>
  <br>
  <br>
  <br>
  <br>

  <div>
<!--    <canvas id="canvastest" width="160" height="160">
    </canvas>-->
  </div>
  <!--&ndash;&gt;-->
  <script type="text/javascript">


    addTimePicker.to(document.getElementsByName("usr_time2")[0]);

    // http://dynamic-tools.net/toolbox/popUp/

/*



    var timePickerCanvasMouseHandler = {

      drag: false,
      offsetLeft: 0,
      offsetTop: 0,

      handleEvent: function handleEvent(left, top) {
//        console.log("left=" + left + ", top=" + top);

      },

      doMouseDown: function (event) {
        this.drag = true
        xPos = event.pageX;
        yPos = event.pageY;

//    console.log("X=" + xPos + ", Y=" + yPos);

        this.handleEvent(xPos - this.offsetLeft, yPos - this.offsetTop);
      },

      stopDrag: function () {
        this.drag = false
      },
      doMouseUp: function (event) {
        this.stopDrag();
      },

      doMouseOut: function (event) {
        this.stopDrag();
      },

      doMouseMove: function (event) {
        if (this.drag) {
          xPos = event.pageX;
          yPos = event.pageY;

//      console.log("X=" + xPos + ", Y=" + yPos);

          this.handleEvent(xPos - this.offsetLeft, yPos - this.offsetTop);
        }
      }


    }


    var cumulativeOffset = function (element) {
      var top = 0, left = 0;
      do {
        top += element.offsetTop || 0;
        left += element.offsetLeft || 0;
        element = element.offsetParent;
      } while (element);

      return {
        top: top,
        left: left
      };
    };

    var timePickerCanvas = document.getElementById('canvastest');
    var timePickerCanvasContext = timePickerCanvas.getContext('2d');
    canvasClockPainter.paintClock(timePickerCanvasContext);

    var timePickerCanvasOffset = cumulativeOffset(timePickerCanvas)
    //    console.log("timePickerCanvasOffset=" + timePickerCanvasOffset.top + ", " + timePickerCanvasOffset.left);
    timePickerCanvasMouseHandler.offsetLeft = timePickerCanvasOffset.left;
    timePickerCanvasMouseHandler.offsetTop = timePickerCanvasOffset.top;

    var initialDate = new Date();
    initialDate.setHours(12)
    initialDate.setMinutes(0)
    var lastSelectedDate = initialDate;

    var lastSelectedTime;

    timePickerCanvasMouseHandler.handleEvent = function handleEvent(offsetFromLeft, offsetFromTop) {
//  console.log("timePickerCanvasOffset from Left=" + offsetFromLeft + ", timePickerCanvasOffset from Top=" + offsetFromTop);
      var numberOfPixelsRightFromCenter = offsetFromLeft - clockRadius;
      var numberOfPixelsBottomFromCenter = offsetFromTop - clockRadius;
      var currentSelectedTime = addTimePicker.getTimeFromCoordinates(numberOfPixelsRightFromCenter, numberOfPixelsBottomFromCenter, lastSelectedDate);
      if (!lastSelectedTime || currentSelectedTime.timeAsString != lastSelectedTime.timeAsString) {
        lastSelectedTime = currentSelectedTime;
        if (currentSelectedTime.date) {
          lastSelectedDate = currentSelectedTime.date;
        }
        document.getElementsByName("usr_time1")[0].value = currentSelectedTime.timeAsString24
        canvasClockPainter.clearCanvas(timePickerCanvasContext)
        canvasClockPainter.paintClock(timePickerCanvasContext)
        canvasClockPainter.paintClockHand(timePickerCanvasContext, currentSelectedTime.hours, currentSelectedTime.minutes)
      }
    };

    canvasClockPainter.paintClockHand(timePickerCanvasContext, 12, 00)

    timePickerCanvas.addEventListener("mousedown", function (event) {
      timePickerCanvasMouseHandler.doMouseDown(event);
    }, false);
    timePickerCanvas.addEventListener("mouseup", function (event) {
      timePickerCanvasMouseHandler.doMouseUp(event);
    }, false);
    timePickerCanvas.addEventListener("mousemove", function (event) {
      timePickerCanvasMouseHandler.doMouseMove(event);
    }, false);
    timePickerCanvas.addEventListener("mouseout", function (event) {
      timePickerCanvasMouseHandler.doMouseOut(event);
    }, false);
*/


  </script>

</section>

</body>
</html>